{% extends "base.html" %}
{% load static %}

{% block title %}Document Status - SmartFileTools{% endblock %}

{% block extra_css %}
<style>
    .status-container {
        max-width: 800px;
        margin: 4rem auto;
        padding: 0 1rem;
    }

    .status-card {
        background: var(--white);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-lg);
        padding: 3rem;
        text-align: center;
    }

    .status-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 2rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
    }

    .status-icon.success {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
    }

    .status-icon.processing {
        background: rgba(59, 130, 246, 0.1);
        color: var(--info);
    }

    .status-icon.error {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger);
    }

    .status-title {
        font-size: 1.75rem;
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 1rem;
    }

    .status-message {
        color: var(--gray-600);
        margin-bottom: 2rem;
        line-height: 1.6;
    }

    .status-details {
        background: var(--gray-100);
        border-radius: var(--radius-md);
        padding: 1.5rem;
        margin: 2rem 0;
        text-align: left;
    }

    .detail-row {
        display: flex;
        justify-content: space-between;
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--gray-200);
    }

    .detail-row:last-child {
        border-bottom: none;
    }

    .detail-label {
        font-weight: 500;
        color: var(--gray-700);
    }

    .detail-value {
        color: var(--gray-900);
    }

    .spinner {
        border: 3px solid var(--gray-200);
        border-top: 3px solid var(--primary-color);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    .action-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="status-container">
        <div class="status-card">
            {% if session.status == 'signed' %}
            <div class="status-icon success">
                <i class="fas fa-check-circle"></i>
            </div>
            <h1 class="status-title">Document Signed Successfully!</h1>
            <p class="status-message">
                Your document has been signed and is ready for download.
            </p>
            {% elif session.status == 'signing' or session.status == 'processing' %}
            <div class="spinner"></div>
            <div class="status-icon processing">
                <i class="fas fa-cog fa-spin"></i>
            </div>
            <h1 class="status-title">Processing Your Document...</h1>
            <p class="status-message">
                Please wait while we finalize your signed document. This usually takes a few seconds.
            </p>
            <script>
                // Auto-refresh every 2 seconds
                setTimeout(() => location.reload(), 2000);
            </script>
            {% elif session.status == 'failed' %}
            <div class="status-icon error">
                <i class="fas fa-exclamation-circle"></i>
            </div>
            <h1 class="status-title">Processing Failed</h1>
            <p class="status-message">
                There was an error processing your document. Please try again or contact support.
            </p>
            {% else %}
            <div class="status-icon processing">
                <i class="fas fa-file-signature"></i>
            </div>
            <h1 class="status-title">Document Ready to Sign</h1>
            <p class="status-message">
                Your document is ready. Please complete the signing process.
            </p>
            {% endif %}

            <div class="status-details">
                <div class="detail-row">
                    <span class="detail-label">Document:</span>
                    <span class="detail-value">{{ session.original_filename }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Status:</span>
                    <span class="detail-value">{{ session.get_status_display }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Created:</span>
                    <span class="detail-value">{{ session.created_at|date:"M d, Y H:i" }}</span>
                </div>
                {% if session.signed_at %}
                <div class="detail-row">
                    <span class="detail-label">Signed:</span>
                    <span class="detail-value">{{ session.signed_at|date:"M d, Y H:i" }}</span>
                </div>
                {% endif %}
            </div>

            <div class="action-buttons">
                {% if session.status == 'signed' and session.signed_pdf %}
                <a href="{% url 'esign:download' session.id %}" class="btn btn-primary btn-lg">
                    <i class="fas fa-download me-2"></i> Download Signed PDF
                </a>
                {% endif %}

                {% if session.status == 'created' %}
                <a href="{% url 'esign:sign' session.id %}" class="btn btn-primary btn-lg">
                    <i class="fas fa-pen me-2"></i> Continue Signing
                </a>
                {% endif %}

                <a href="{% url 'esign:upload' %}" class="btn btn-secondary">
                    <i class="fas fa-plus me-2"></i> Sign Another Document
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}